var data = {
	daily: [
		{
			"ref_date": "20170412",
			"session_cnt": 8,
			"visit_pv": 49,
			"visit_uv": 4,
			"visit_uv_new": 1,
			"stay_time_uv": 73.75,
			"stay_time_session": 36.875,
			"visit_depth": 3.25
		},
		{
			"ref_date": "20170413",
			"session_cnt": 10,
			"visit_pv": 81,
			"visit_uv": 8,
			"visit_uv_new": 2,
			"stay_time_uv": 351.25,
			"stay_time_session": 281,
			"visit_depth": 3.5
		},
		{
			"ref_date": "20170414",
			"session_cnt": 17,
			"visit_pv": 58,
			"visit_uv": 10,
			"visit_uv_new": 4,
			"stay_time_uv": 187.3,
			"stay_time_session": 110.1765,
			"visit_depth": 2.4706
		},
		{
			"ref_date": "20170415",
			"session_cnt": 2,
			"visit_pv": 6,
			"visit_uv": 2,
			"visit_uv_new": 0,
			"stay_time_uv": 17.5,
			"stay_time_session": 17.5,
			"visit_depth": 3
		},
		{
			"ref_date": "20170416",
			"session_cnt": 9,
			"visit_pv": 78,
			"visit_uv": 5,
			"visit_uv_new": 2,
			"stay_time_uv": 90.2,
			"stay_time_session": 50.1111,
			"visit_depth": 4.6667
		},
		{
			"ref_date": "20170417",
			"session_cnt": 21,
			"visit_pv": 155,
			"visit_uv": 10,
			"visit_uv_new": 4,
			"stay_time_uv": 173.8,
			"stay_time_session": 82.7619,
			"visit_depth": 3.4286
		},
		{
			"ref_date": "20170418",
			"session_cnt": 17,
			"visit_pv": 118,
			"visit_uv": 11,
			"visit_uv_new": 4,
			"stay_time_uv": 67.7273,
			"stay_time_session": 43.8235,
			"visit_depth": 3.8824
		},
		{
			"ref_date": "20170419",
			"session_cnt": 32,
			"visit_pv": 197,
			"visit_uv": 18,
			"visit_uv_new": 10,
			"stay_time_uv": 90.7222,
			"stay_time_session": 51.0313,
			"visit_depth": 3.5313
		},
		{
			"ref_date": "20170420",
			"session_cnt": 25,
			"visit_pv": 138,
			"visit_uv": 11,
			"visit_uv_new": 6,
			"stay_time_uv": 80.8182,
			"stay_time_session": 35.56,
			"visit_depth": 3.64
		},
		{
			"ref_date": "20170421",
			"session_cnt": 20,
			"visit_pv": 141,
			"visit_uv": 13,
			"visit_uv_new": 4,
			"stay_time_uv": 270.5385,
			"stay_time_session": 175.85,
			"visit_depth": 3.3
		},
		{
			"ref_date": "20170422",
			"session_cnt": 11,
			"visit_pv": 116,
			"visit_uv": 9,
			"visit_uv_new": 3,
			"stay_time_uv": 116.8889,
			"stay_time_session": 95.6364,
			"visit_depth": 4.6364
		},
		{
			"ref_date": "20170423",
			"session_cnt": 12,
			"visit_pv": 90,
			"visit_uv": 7,
			"visit_uv_new": 2,
			"stay_time_uv": 122,
			"stay_time_session": 71.1667,
			"visit_depth": 3
		},
		{
			"ref_date": "20170424",
			"session_cnt": 27,
			"visit_pv": 214,
			"visit_uv": 12,
			"visit_uv_new": 5,
			"stay_time_uv": 72,
			"stay_time_session": 32,
			"visit_depth": 4.2593
		},
		{
			"ref_date": "20170425",
			"session_cnt": 73,
			"visit_pv": 627,
			"visit_uv": 29,
			"visit_uv_new": 23,
			"stay_time_uv": 123.2759,
			"stay_time_session": 48.9726,
			"visit_depth": 4.0959
		},
		{
			"ref_date": "20170426",
			"session_cnt": 48,
			"visit_pv": 394,
			"visit_uv": 18,
			"visit_uv_new": 11,
			"stay_time_uv": 139.7222,
			"stay_time_session": 52.3958,
			"visit_depth": 3.75
		},
		{
			"ref_date": "20170427",
			"session_cnt": 34,
			"visit_pv": 289,
			"visit_uv": 18,
			"visit_uv_new": 9,
			"stay_time_uv": 91.2222,
			"stay_time_session": 48.2941,
			"visit_depth": 4.3529
		},
		{
			"ref_date": "20170428",
			"session_cnt": 55,
			"visit_pv": 595,
			"visit_uv": 24,
			"visit_uv_new": 16,
			"stay_time_uv": 235.8333,
			"stay_time_session": 102.9091,
			"visit_depth": 4.3636
		},
		{
			"ref_date": "20170429",
			"session_cnt": 18,
			"visit_pv": 82,
			"visit_uv": 12,
			"visit_uv_new": 3,
			"stay_time_uv": 57.3333,
			"stay_time_session": 38.2222,
			"visit_depth": 2.7778
		},
		{
			"ref_date": "20170430",
			"session_cnt": 57,
			"visit_pv": 413,
			"visit_uv": 20,
			"visit_uv_new": 8,
			"stay_time_uv": 136.4,
			"stay_time_session": 47.8596,
			"visit_depth": 3.8772
		},
		{
			"ref_date": "20170501",
			"session_cnt": 41,
			"visit_pv": 299,
			"visit_uv": 14,
			"visit_uv_new": 10,
			"stay_time_uv": 103.1429,
			"stay_time_session": 35.2195,
			"visit_depth": 3.5366
		},
		{
			"ref_date": "20170502",
			"session_cnt": 43,
			"visit_pv": 349,
			"visit_uv": 27,
			"visit_uv_new": 13,
			"stay_time_uv": 80.8519,
			"stay_time_session": 50.7674,
			"visit_depth": 3.6744
		},
		{
			"ref_date": "20170503",
			"session_cnt": 76,
			"visit_pv": 565,
			"visit_uv": 35,
			"visit_uv_new": 20,
			"stay_time_uv": 76.5429,
			"stay_time_session": 35.25,
			"visit_depth": 3.75
		},
		{
			"ref_date": "20170504",
			"session_cnt": 75,
			"visit_pv": 509,
			"visit_uv": 34,
			"visit_uv_new": 18,
			"stay_time_uv": 122.6765,
			"stay_time_session": 55.6133,
			"visit_depth": 3.3733
		},
		{
			"ref_date": "20170505",
			"session_cnt": 74,
			"visit_pv": 552,
			"visit_uv": 34,
			"visit_uv_new": 18,
			"stay_time_uv": 106.5294,
			"stay_time_session": 48.9459,
			"visit_depth": 3.8514
		},
		{
			"ref_date": "20170506",
			"session_cnt": 33,
			"visit_pv": 348,
			"visit_uv": 21,
			"visit_uv_new": 9,
			"stay_time_uv": 109.9048,
			"stay_time_session": 69.9394,
			"visit_depth": 4.2424
		},
		{
			"ref_date": "20170507",
			"session_cnt": 93,
			"visit_pv": 663,
			"visit_uv": 27,
			"visit_uv_new": 12,
			"stay_time_uv": 172.9259,
			"stay_time_session": 50.2043,
			"visit_depth": 3.3871
		},
		{
			"ref_date": "20170508",
			"session_cnt": 117,
			"visit_pv": 900,
			"visit_uv": 44,
			"visit_uv_new": 21,
			"stay_time_uv": 311.5909,
			"stay_time_session": 117.1795,
			"visit_depth": 3.6496
		},
		{
			"ref_date": "20170509",
			"session_cnt": 83,
			"visit_pv": 566,
			"visit_uv": 41,
			"visit_uv_new": 21,
			"stay_time_uv": 154.9024,
			"stay_time_session": 76.5181,
			"visit_depth": 3.4699
		},
		{
			"ref_date": "20170510",
			"session_cnt": 109,
			"visit_pv": 786,
			"visit_uv": 52,
			"visit_uv_new": 35,
			"stay_time_uv": 264.5577,
			"stay_time_session": 126.211,
			"visit_depth": 3.4495
		},
		{
			"ref_date": "20170511",
			"session_cnt": 86,
			"visit_pv": 554,
			"visit_uv": 42,
			"visit_uv_new": 19,
			"stay_time_uv": 80.1667,
			"stay_time_session": 39.1512,
			"visit_depth": 3.0581
		},
		{
			"ref_date": "20170512",
			"session_cnt": 109,
			"visit_pv": 850,
			"visit_uv": 49,
			"visit_uv_new": 32,
			"stay_time_uv": 95.0408,
			"stay_time_session": 42.7248,
			"visit_depth": 3.6514
		}
	]
}

var page = {
	index: 0,

	onBackground: function (e) {
		if (e.detail.value)
			this.setData({ Canvas1: { background: 0xFFD4D0C8 } });
		else
			this.setData({ Canvas1: { background: 0x00000000 } });

		this.setData({ Canvas1: { refresh: true } });
	},

	canvas1: function () {
		var ctx = pm.createCanvasContext('Canvas1', this);

		var grd = ctx.createCircularGradient(75, 50, 50);
		grd.addColorStop(0, 'red');
		grd.addColorStop(1, 'white');

		ctx.setFillStyle(grd);
		ctx.fillRect(10, 10, 150, 80);
		ctx.draw();
	},

	canvas2: function () {
		var ctx = pm.createCanvasContext('Canvas1', this);

		// Create linear gradient
		var grd = ctx.createLinearGradient(0, 0, 200, 0)
		grd.addColorStop(0, 'red')
		grd.addColorStop(1, 'white')

		// Fill with gradient
		ctx.setFillStyle(grd)
		ctx.fillRect(10, 10, 150, 120)
		ctx.draw()
	},

	canvas3: function () {
		var ctx = pm.createCanvasContext('Canvas1', this);
		ctx.setFillStyle('red')
		ctx.fillRect(10, 10, 150, 100)
		ctx.setGlobalAlpha(0.2)
		ctx.setFillStyle('blue')
		ctx.fillRect(50, 50, 150, 100)
		ctx.setFillStyle('yellow')
		ctx.fillRect(100, 100, 150, 100)
		ctx.draw();
	},

	canvas4: function () {
		var ctx = pm.createCanvasContext('Canvas1', this);

		// Draw points
		ctx.beginPath()
		ctx.arc(20, 20, 2, 0, 2 * Math.PI)
		ctx.setFillStyle('red')
		ctx.fill()

		ctx.beginPath()
		ctx.arc(200, 20, 2, 0, 2 * Math.PI)
		ctx.setFillStyle('lightgreen')
		ctx.fill()

		ctx.beginPath()
		ctx.arc(20, 100, 2, 0, 2 * Math.PI)
		ctx.arc(200, 100, 2, 0, 2 * Math.PI)
		ctx.setFillStyle('blue')
		ctx.fill()

		ctx.setFillStyle('black')
		// ctx.setFontSize(12)

		// Draw guides
		ctx.beginPath()
		ctx.moveTo(20, 20)
		ctx.lineTo(20, 100)
		ctx.lineTo(150, 75)

		ctx.moveTo(200, 20)
		ctx.lineTo(200, 100)
		ctx.lineTo(70, 75)
		ctx.setStrokeStyle('#AAAAAA')
		ctx.stroke()

		// Draw quadratic curve
		ctx.beginPath()
		ctx.moveTo(20, 20)
		ctx.bezierCurveTo(20, 100, 200, 100, 200, 20)
		ctx.setStrokeStyle('black')
		ctx.stroke()

		ctx.draw()
	},

	canvas5: function () {
		var ctx = pm.createCanvasContext('Canvas1', this);

		ctx.strokeRect(100, 10, 150, 100)
		ctx.rotate(20 * Math.PI / 180)
		ctx.strokeRect(100, 10, 150, 100)
		ctx.rotate(20 * Math.PI / 180)
		ctx.strokeRect(100, 10, 150, 100)

		ctx.draw()
	},

	canvas6: function () {
		var ctx = pm.createCanvasContext('Canvas1', this);

		// Draw coordinates
		ctx.arc(100, 75, 50, 0, 2 * Math.PI)
		ctx.setFillStyle('#EEEEEE')
		ctx.fill()

		ctx.beginPath()
		ctx.moveTo(40, 75)
		ctx.lineTo(160, 75)
		ctx.moveTo(100, 15)
		ctx.lineTo(100, 135)
		ctx.setStrokeStyle('#AAAAAA')
		ctx.stroke()

		// ctx.setFontSize(12)
		ctx.setFillStyle('black')
		ctx.fillText('0', 165, 78)
		ctx.fillText('0.5*PI', 83, 145)
		ctx.fillText('1*PI', 15, 78)
		ctx.fillText('1.5*PI', 83, 10)

		// Draw points
		ctx.beginPath()
		ctx.arc(100, 75, 2, 0, 2 * Math.PI)
		ctx.setFillStyle('lightgreen')
		ctx.fill()

		ctx.beginPath()
		ctx.arc(100, 25, 2, 0, 2 * Math.PI)
		ctx.setFillStyle('blue')
		ctx.fill()

		ctx.beginPath()
		ctx.arc(150, 75, 2, 0, 2 * Math.PI)
		ctx.setFillStyle('red')
		ctx.fill()

		// Draw arc
		ctx.beginPath()
		ctx.arc(100, 75, 50, 0, 1.5 * Math.PI)
		ctx.setStrokeStyle('#333333')
		ctx.stroke()

		ctx.draw()
	},

	canvas8: function () {
		var context = pm.createCanvasContext('Canvas1', this);

		context.beginPath();
		context.arc(100, 100, 99, 0, 2 * Math.PI);

		context.moveTo(194, 100);
		context.arc(100, 100, 94, 0, 2 * Math.PI);

		context.translate(100, 100);

		context.moveTo(0, 0);
		context.lineTo(0, -85);

		context.moveTo(0, 0);
		context.lineTo(-65, 0);

		context.stroke();
		context.draw();
	},

	canvas9: function () {
		var context = pm.createCanvasContext('Canvas1', this);

		var array = [20, 30, 40, 50];
		var colors = ["#ff0000", "#ffff00", "#0000ff", "#00ff00"];
		var total = 0;

		for (var index = 0; index < array.length; index++) {
			total += array[index];
		}

		var point = { x: 100, y: 100 };
		var radius = 60;

		for (var i = 0; i < array.length; i++) {
			context.beginPath();

			var start = 0;
			if (i > 0) {
				for (var j = 0; j < i; j++) {
					start += array[j] / total * 2 * Math.PI;
				}
			}
			// console.log("i:" + i);
			// console.log("start:" + start);
			// console.log("end: " + array[i] / total * 2 * Math.PI);
			context.arc(point.x, point.y, radius, start, start + array[i] / total * 2 * Math.PI);
			context.lineTo(point.x, point.y);
			context.setFillStyle(colors[i]);
			context.fill();
			context.closePath();
		}

		context.draw();
	},

	canvas10: function (e) {
		var canvasWidth = 285;
		var canvasHeight = 206;
		var ratioX = 10;
		var ratioY = 5;

		// 浅紫
		var lightPurple = '#d6dbf4';
		// 紫色
		var purple = '#7587db';
		// 浅灰
		var lightGray = '#c7cce5';
		// 灰色
		var gray  = '#cccccc';
		var black = '#000000';
	
		var context = pm.createCanvasContext('Canvas1', this);

		/* Part1.画折线 */
		data.daily.forEach(function (daily, i, array) {
			if (i < array.length - 1) {
				// 当前点坐标
				var currentPoint = {
					x: i * ratioX,
					y: canvasHeight - daily.visit_uv_new * ratioY
				};
				// 下一个点坐标
				var nextPoint = {
					x: (i + 1) * ratioX,
					y: canvasHeight - array[i + 1].visit_uv_new * ratioY
				}
				// 开始
				context.beginPath();
				// 移动到当前点
				context.moveTo(currentPoint.x, currentPoint.y);
				// 画线到下个点
				context.lineTo(nextPoint.x, nextPoint.y);
				// 设置属性
				context.setLineWidth(1);
				// 设置颜色
				context.setStrokeStyle(purple);
				// 描线
				context.stroke();
				// 竖直往下，至x轴
				context.lineTo(nextPoint.x, canvasHeight);
				// 水平往左，至上一个点的在x轴的垂点
				context.lineTo(currentPoint.x, canvasHeight);
				// 设置淡紫色
				context.setFillStyle(lightPurple);
				// 实现闭合与x轴之前的区域
				context.fill();
			}
		});

		/* Part2.画圆圈 */
		data.daily.forEach(function (daily, i, array) {
			// 当前点坐标
			var currentPoint = {
				x: i * ratioX,
				y: canvasHeight - daily.visit_uv_new * ratioY
			};
			context.beginPath();
			context.arc(currentPoint.x, currentPoint.y, 2, 0, 2 * Math.PI);
			context.setStrokeStyle(purple);
			context.setFillStyle('white');
			context.stroke();
			context.fill();
		});

		/* Part3.画横向参照线 */
		var lineCount = 4;
		var estimateRatio = 2;
		var ratio = canvasHeight / lineCount;
		for (var i = 0; i < lineCount; i++) {
			context.beginPath();
			var currentPoint = {
				x: 0,
				y: canvasHeight - i * ratio
			};
			// 移动到原点
			context.moveTo(currentPoint.x, currentPoint.y);
			// 向Y正轴方向画线
			context.lineTo(canvasWidth, canvasHeight - i * ratio);
			// 设置属性
			context.setLineWidth(1);
			// 设置颜色
			context.setStrokeStyle(lightGray);
			context.stroke();
			// 标注数值
			context.setFillStyle(black);
			context.fillText((i * ratio / estimateRatio).toFixed(0), currentPoint.x, currentPoint.y);
		}
		context.draw();
	},

	onLoad: function (e) {
		this.setData({ imageTitle: "titile_curve.png" });

		this.onNextButton(0);
	},

	onBackButton: function (e) {
		pm.navigateBack();
	},

	onNextButton: function (e) {
		var canvas = [this.canvas1, this.canvas2, this.canvas3, this.canvas4, this.canvas5, 
			this.canvas6, this.canvas10, this.canvas8, this.canvas9];

		var func = canvas[this.index];

		this.index++;
		if (this.index >= canvas.length) this.index = 0;

		func.call(this);
	},
};

Page(page);
